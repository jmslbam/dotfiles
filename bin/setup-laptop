#!/usr/bin/env bash
### end common-components/bash-shebang

# Welcome to the thoughtbot laptop script! Be prepared to turn your laptop (or
# desktop, no haters here) into an awesome development machine.

# This file is auto-generated. Do not edit it by hand unless you know what
# you're doing. Please see 'CONTRIBUTING.md' for more information.
### end common-components/header

trap 'ret=$?; test $ret -ne 0 && printf "failed\n\n" >&2; exit $ret' EXIT

set -e
### end common-components/exit-trap

#user ' - What is your (github) author name?'
#read -e FULLNAME
#user ' - What is your (github author) email?'
#read -e EMIAL

if [[ ! -d "$HOME/.bin/" ]]; then
  mkdir "$HOME/.bin"
fi

if [ ! -f "$HOME/.zshrc" ]; then
  touch $HOME/.zshrc
fi

if [[ ":$PATH:" != *":$HOME/.bin:"* ]]; then
  printf 'export PATH="$HOME/.bin:$PATH"\n' >> ~/.zshrc
  export PATH="$HOME/.bin:$PATH"
fi
### end common-components/check-home-bin

fancy_echo() {
  printf "\n%b\n" "$1"
}
### end common-components/shared-functions


if ! command -v brew &>/dev/null; then
  fancy_echo "Installing Homebrew, a good OS X package manager ..."
    ruby <(curl -fsS https://raw.github.com/Homebrew/homebrew/go/install)

  if ! grep -qs "recommended by brew doctor" ~/.zshrc; then
    fancy_echo "Put Homebrew location earlier in PATH ..."
      printf '\n# recommended by brew doctor\n' >> ~/.zshrc
      printf 'export PATH="/usr/local/bin:$PATH"\n' >> ~/.zshrc
      export PATH="/usr/local/bin:$PATH"
  fi
else
  fancy_echo "Homebrew already installed. Skipping ..."
fi

fancy_echo "Updating Homebrew formulas ..."
 brew update

fancy_echo "Running Brewfile"
  brew bundle Brewfile

fancy_echo "Running Caskfile"
  brew bundle Caskfile

fancy_echo "Upgrading and linking OpenSSL ..."
  brew install openssl
  brew link openssl --force
  brew install curl-ca-bundle
### end mac-components/compiler-and-libraries

#fancy_echo "Changing your shell to zsh ..."
#  chsh -s $(which zsh)
### end common-components/zsh

if [[ -f /etc/zshenv ]]; then
  fancy_echo "Fixing OSX zsh environment bug ..."
    sudo mv /etc/{zshenv,zshrc}
fi
### end mac-components/zsh-fix


fancy_echo "Copy dotfiles with rcup"
  rcup -d dotfiles -x README.md -x LICENSE -x Brewfile Caskfile .gitignore
	#exec $HOME/dotfiles/scripts/bootstrap

# Overwrites .zshrc
fancy_echo "Installing oh-my-zsh ..."
  curl -L http://install.ohmyz.sh | sh


fancy_echo "Set defaults (for now only OSX)"
	exec $HOME/dotfiles/osx/set-defaults.sh


#Gen SSH key add asking for it.
fancy_echo "Generate new SSH key... not"
  #if [[ ! -d "$HOME/.ssh/" ]]; then
  #  mkdir "$HOME/.ssh"
  #fi
  # prompt for e-mail
  #ssh-keygen -t rsa -C "$EMAIL"

  #ssh-add ~/.ssh/id_rsa
  #pbcopy < ~/.ssh/id_rsa.pub
  #fancy_echo "You public key has been add to you clipboard to copy to GitHub etc"
  #open http://github.com

# Install add-ons for Firefox
open "https://addons.mozilla.org/firefox/downloads/latest/60/addon-60-latest.xpi?src=dp-btn-primary" #Developer toolbar
open "https://addons.mozilla.org/firefox/downloads/latest/1843/addon-1843-latest.xpi?src=dp-btn-primary" #Firebug
open "https://addons.mozilla.org/firefox/downloads/file/132566/show_quit_warning-2.0.0-fx.xpi?src=search" #ask quite dialog